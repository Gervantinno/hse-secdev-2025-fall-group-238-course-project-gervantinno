# ADR-003: Secrets Management

Дата: 2025-11-03
Статус: Accepted

## Context

- Сервису требуются различные секреты (API ключи, credentials).
- Хранение секретов в коде или конфигах небезопасно.
- Необходима регулярная ротация секретов.

## Decision

- Использовать HashiCorp Vault для хранения секретов:
  - Доступ через IAM роли
  - Автоматическая ротация каждые 30 дней
  - Версионирование секретов
- Получение секретов только через переменные окружения.
- Маскирование секретов в логах через middleware.

## Alternatives

- AWS Secrets Manager (минус - vendor lock-in).
- .env файлы (минус - нет ротации и аудита).
- Кастомное решение (минус - риски безопасности).

## Consequences

**Плюсы:**

- Централизованное управление секретами.
- Автоматическая ротация и аудит.
- Безопасное хранение и доступ.

**Минусы:**

- Дополнительная инфраструктура (Vault).
- Необходимость настройки IAM.

## Security impact

- Снижение риска R2 (утечка секретов).
- Соответствие NFR-05 (ротация API-ключей).
- Улучшение аудита через логирование доступа.

## Rollout plan

1. Развернуть HashiCorp Vault.
2. Создать `app/core/secrets.py` для работы с Vault.
3. Настроить автоматическую ротацию.
4. Добавить тесты в tests/test_secrets.py.

## Links

- **NFR:** [NFR-05](https://github.com/hse-secdev-2025-fall/course-project-Gervantinno/pull/4)
- **Threat Model:** Поток [F1 /login] → Риск [R2]
- **Тесты:** `tests/test_secrets.py`
- **RISKS.md:** R2 — Утечка секретов
  - Критерий закрытия: Проверка механизма ротации и отсутствия секретов в логах
